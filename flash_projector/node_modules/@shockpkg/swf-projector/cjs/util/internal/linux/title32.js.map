{"version":3,"file":"title32.js","names":["_asm","require","_title","PatchTitle32","PatchTitle","exports","title32","_addr_","check","shdr","i","d","_findFuzzyCode","TITLE_I386","v","DataView","buffer","byteOffset","byteLength","ptr","getUint32","shdr2","_getShdrForAddress","v2","data","i2","shAddr","ptr2","str","_readCstr","titleMatchM","test","patch","addr","_theShdrForAddress","setUint8","setUint32","_titleA","_addrs_","titleMatchA","push","length","len","_titleL","_ebx_","ebx","_findEbx","getInt32","setInt32"],"sources":["../../../../src/util/internal/linux/title32.ts"],"sourcesContent":["/* eslint-disable max-classes-per-file */\n\nimport {TITLE_I386} from './asm.ts';\nimport {Elf32} from './elf.ts';\nimport {PatchTitle, titleMatchM, titleMatchA} from './title.ts';\n\n/**\n * PatchTitle32 object.\n */\nexport abstract class PatchTitle32 extends PatchTitle<Elf32> {}\n\n/**\n * Patch objects.\n */\nexport const title32 = [\n\t/**\n\t * 6.0.79.0 i386.\n\t */\n\tclass extends PatchTitle32 {\n\t\tprivate _addr_ = 0;\n\n\t\t/**\n\t\t * @inheritDoc\n\t\t */\n\t\tpublic check() {\n\t\t\tfor (const [shdr, i, d] of this._findFuzzyCode(TITLE_I386['6'])) {\n\t\t\t\tconst v = new DataView(d.buffer, d.byteOffset, d.byteLength);\n\t\t\t\tconst ptr = v.getUint32(i + 9, true);\n\t\t\t\tconst shdr2 = this._getShdrForAddress(ptr);\n\t\t\t\tif (!shdr2) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tconst v2 = new DataView(shdr2.data);\n\t\t\t\tconst i2 = ptr - shdr2.shAddr;\n\t\t\t\tconst ptr2 = v2.getUint32(i2, true);\n\t\t\t\tconst str = this._readCstr(ptr2);\n\t\t\t\tif (!str || !titleMatchM.test(str)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tthis._addr_ = shdr.shAddr + i;\n\t\t\t}\n\t\t\treturn !!this._addr_;\n\t\t}\n\n\t\t/**\n\t\t * @inheritDoc\n\t\t */\n\t\tpublic patch() {\n\t\t\tconst addr = this._addr_;\n\t\t\tconst shdr = this._theShdrForAddress(addr);\n\t\t\tconst v = new DataView(shdr.data);\n\t\t\tlet i = addr - shdr.shAddr + 7;\n\n\t\t\t// nop\n\t\t\tv.setUint8(i++, 0x90);\n\n\t\t\t// push     ...\n\t\t\tv.setUint8(i++, 0x68);\n\t\t\tv.setUint32(i, this._titleA, true);\n\t\t}\n\t},\n\n\t/**\n\t * 9.0.115.0 i386.\n\t */\n\tclass extends PatchTitle32 {\n\t\tprivate _addrs_ = [] as number[];\n\n\t\t/**\n\t\t * @inheritDoc\n\t\t */\n\t\tpublic check() {\n\t\t\tthis._addrs_ = [];\n\t\t\tfor (const [shdr, i, d] of this._findFuzzyCode(TITLE_I386['9'])) {\n\t\t\t\tconst v = new DataView(d.buffer, d.byteOffset, d.byteLength);\n\t\t\t\tconst ptr = v.getUint32(i + 6, true);\n\t\t\t\tconst shdr2 = this._getShdrForAddress(ptr);\n\t\t\t\tif (!shdr2) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tconst v2 = new DataView(shdr2.data);\n\t\t\t\tconst i2 = ptr - shdr2.shAddr;\n\t\t\t\tconst ptr2 = v2.getUint32(i2, true);\n\t\t\t\tconst str = this._readCstr(ptr2);\n\t\t\t\tif (!str || !titleMatchA.test(str)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tthis._addrs_.push(shdr.shAddr + i);\n\t\t\t}\n\t\t\treturn this._addrs_.length === 2;\n\t\t}\n\n\t\t/**\n\t\t * @inheritDoc\n\t\t */\n\t\tpublic patch() {\n\t\t\tfor (const addr of this._addrs_) {\n\t\t\t\tconst shdr = this._theShdrForAddress(addr);\n\t\t\t\tconst v = new DataView(shdr.data);\n\t\t\t\tlet i = addr - shdr.shAddr + 5;\n\n\t\t\t\t// mov     eax, ...\n\t\t\t\tv.setUint8(i++, 0xb8);\n\t\t\t\tv.setUint32(i, this._titleA, true);\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t * 10.1.53.64 i386.\n\t */\n\tclass extends PatchTitle32 {\n\t\tprivate _addr_ = 0;\n\n\t\t/**\n\t\t * @inheritDoc\n\t\t */\n\t\tpublic check() {\n\t\t\tfor (const [shdr, i, d] of this._findFuzzyCode(\n\t\t\t\tTITLE_I386['10.1']\n\t\t\t)) {\n\t\t\t\tconst v = new DataView(d.buffer, d.byteOffset, d.byteLength);\n\t\t\t\tconst addr = shdr.shAddr + i;\n\t\t\t\tconst ptr = v.getUint32(i + 12, true);\n\t\t\t\tconst len = v.getUint32(i + 4, true);\n\t\t\t\tconst str = this._readCstr(ptr);\n\t\t\t\tif (!str || str.length !== len || !titleMatchA.test(str)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif (this._addr_) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tthis._addr_ = addr;\n\t\t\t}\n\t\t\treturn !!this._addr_;\n\t\t}\n\n\t\t/**\n\t\t * @inheritDoc\n\t\t */\n\t\tpublic patch() {\n\t\t\tconst addr = this._addr_;\n\t\t\tconst shdr = this._theShdrForAddress(addr);\n\t\t\tconst v = new DataView(shdr.data);\n\t\t\tconst i = addr - shdr.shAddr;\n\t\t\tv.setUint32(i + 12, this._titleA, true);\n\t\t\tv.setUint32(i + 4, this._titleL, true);\n\t\t}\n\t},\n\n\t/**\n\t * 11.2.202.228 i386.\n\t */\n\tclass extends PatchTitle32 {\n\t\tprivate _addr_ = 0;\n\n\t\tprivate _ebx_ = 0;\n\n\t\t/**\n\t\t * @inheritDoc\n\t\t */\n\t\tpublic check() {\n\t\t\tfor (const [shdr, i, d] of this._findFuzzyCode(\n\t\t\t\tTITLE_I386['11.2']\n\t\t\t)) {\n\t\t\t\tconst addr = shdr.shAddr + i;\n\t\t\t\tconst ebx = this._findEbx(addr);\n\t\t\t\tif (ebx === null) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tconst v = new DataView(d.buffer, d.byteOffset, d.byteLength);\n\t\t\t\tconst ptr = ebx + v.getInt32(i + 2, true);\n\t\t\t\tconst len = v.getUint32(i + 14, true);\n\t\t\t\tconst str = this._readCstr(ptr);\n\t\t\t\tif (!str || str.length !== len || !titleMatchA.test(str)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif (this._addr_) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tthis._addr_ = addr;\n\t\t\t\tthis._ebx_ = ebx;\n\t\t\t}\n\t\t\treturn !!this._addr_;\n\t\t}\n\n\t\t/**\n\t\t * @inheritDoc\n\t\t */\n\t\tpublic patch() {\n\t\t\tconst addr = this._addr_;\n\t\t\tconst ebx = this._ebx_;\n\t\t\tconst shdr = this._theShdrForAddress(addr);\n\t\t\tconst v = new DataView(shdr.data);\n\t\t\tconst i = addr - shdr.shAddr;\n\t\t\tv.setInt32(i + 2, this._titleA - ebx, true);\n\t\t\tv.setUint32(i + 14, this._titleL, true);\n\t\t}\n\t}\n] as (new (elf: Elf32, titleA: number, titleL: number) => PatchTitle32)[];\n"],"mappings":"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","ignoreList":[]}