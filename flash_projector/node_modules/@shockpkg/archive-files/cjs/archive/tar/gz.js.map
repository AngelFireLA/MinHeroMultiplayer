{"version":3,"file":"gz.js","names":["_nodeZlib","require","_tar","ArchiveTarGz","ArchiveTar","FILE_EXTENSIONS","constructor","path","_decompress","input","gz","createGunzip","datas","on","data","push","chunk","length","shift","Promise","resolve","reject","write","err","once","end","exports"],"sources":["../../../src/archive/tar/gz.ts"],"sourcesContent":["import {createGunzip} from 'node:zlib';\n\nimport {ArchiveTar} from '../tar.ts';\n\n/**\n * ArchiveTarGz object.\n */\nexport class ArchiveTarGz extends ArchiveTar {\n\t/**\n\t * @inheritdoc\n\t */\n\tpublic static readonly FILE_EXTENSIONS: readonly string[] | null = [\n\t\t'.tar.gz',\n\t\t'.tgz'\n\t];\n\n\t/**\n\t * ArchiveTarGz constructor.\n\t *\n\t * @param path File path.\n\t */\n\tconstructor(path: string) {\n\t\tsuper(path);\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tprotected async *_decompress(input: AsyncGenerator<Buffer>) {\n\t\tconst gz = createGunzip();\n\t\tconst datas: Buffer[] = [];\n\t\tgz.on('data', (data: Buffer) => {\n\t\t\tdatas.push(data);\n\t\t});\n\t\tfor await (const chunk of input) {\n\t\t\twhile (datas.length) {\n\t\t\t\tyield datas.shift() as Buffer;\n\t\t\t}\n\t\t\tawait new Promise<void>((resolve, reject) => {\n\t\t\t\tgz.write(chunk, err => {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treject(err);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t});\n\t\t\twhile (datas.length) {\n\t\t\t\tyield datas.shift() as Buffer;\n\t\t\t}\n\t\t}\n\t\twhile (datas.length) {\n\t\t\tyield datas.shift() as Buffer;\n\t\t}\n\t\tawait new Promise<void>((resolve, reject) => {\n\t\t\tgz.once('end', resolve);\n\t\t\tgz.once('error', reject);\n\t\t\tgz.end();\n\t\t});\n\t\twhile (datas.length) {\n\t\t\tyield datas.shift() as Buffer;\n\t\t}\n\t}\n}\n"],"mappings":";;;;;;AAAA,IAAAA,SAAA,GAAAC,OAAA;AAEA,IAAAC,IAAA,GAAAD,OAAA;AAEA;AACA;AACA;AACO,MAAME,YAAY,SAASC,eAAU,CAAC;EAC5C;AACD;AACA;EACC,OAAuBC,eAAe,GAA6B,CAClE,SAAS,EACT,MAAM,CACN;;EAED;AACD;AACA;AACA;AACA;EACCC,WAAWA,CAACC,IAAY,EAAE;IACzB,KAAK,CAACA,IAAI,CAAC;EACZ;;EAEA;AACD;AACA;EACC,OAAiBC,WAAWA,CAACC,KAA6B,EAAE;IAC3D,MAAMC,EAAE,GAAG,IAAAC,sBAAY,EAAC,CAAC;IACzB,MAAMC,KAAe,GAAG,EAAE;IAC1BF,EAAE,CAACG,EAAE,CAAC,MAAM,EAAGC,IAAY,IAAK;MAC/BF,KAAK,CAACG,IAAI,CAACD,IAAI,CAAC;IACjB,CAAC,CAAC;IACF,WAAW,MAAME,KAAK,IAAIP,KAAK,EAAE;MAChC,OAAOG,KAAK,CAACK,MAAM,EAAE;QACpB,MAAML,KAAK,CAACM,KAAK,CAAC,CAAW;MAC9B;MACA,MAAM,IAAIC,OAAO,CAAO,CAACC,OAAO,EAAEC,MAAM,KAAK;QAC5CX,EAAE,CAACY,KAAK,CAACN,KAAK,EAAEO,GAAG,IAAI;UACtB,IAAIA,GAAG,EAAE;YACRF,MAAM,CAACE,GAAG,CAAC;YACX;UACD;UACAH,OAAO,CAAC,CAAC;QACV,CAAC,CAAC;MACH,CAAC,CAAC;MACF,OAAOR,KAAK,CAACK,MAAM,EAAE;QACpB,MAAML,KAAK,CAACM,KAAK,CAAC,CAAW;MAC9B;IACD;IACA,OAAON,KAAK,CAACK,MAAM,EAAE;MACpB,MAAML,KAAK,CAACM,KAAK,CAAC,CAAW;IAC9B;IACA,MAAM,IAAIC,OAAO,CAAO,CAACC,OAAO,EAAEC,MAAM,KAAK;MAC5CX,EAAE,CAACc,IAAI,CAAC,KAAK,EAAEJ,OAAO,CAAC;MACvBV,EAAE,CAACc,IAAI,CAAC,OAAO,EAAEH,MAAM,CAAC;MACxBX,EAAE,CAACe,GAAG,CAAC,CAAC;IACT,CAAC,CAAC;IACF,OAAOb,KAAK,CAACK,MAAM,EAAE;MACpB,MAAML,KAAK,CAACM,KAAK,CAAC,CAAW;IAC9B;EACD;AACD;AAACQ,OAAA,CAAAvB,YAAA,GAAAA,YAAA","ignoreList":[]}