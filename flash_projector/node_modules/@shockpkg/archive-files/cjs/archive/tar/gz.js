"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ArchiveTarGz = void 0;
var _nodeZlib = require("node:zlib");
var _tar = require("../tar.js");
/**
 * ArchiveTarGz object.
 */
class ArchiveTarGz extends _tar.ArchiveTar {
  /**
   * @inheritdoc
   */
  static FILE_EXTENSIONS = ['.tar.gz', '.tgz'];

  /**
   * ArchiveTarGz constructor.
   *
   * @param path File path.
   */
  constructor(path) {
    super(path);
  }

  /**
   * @inheritDoc
   */
  async *_decompress(input) {
    const gz = (0, _nodeZlib.createGunzip)();
    const datas = [];
    gz.on('data', data => {
      datas.push(data);
    });
    for await (const chunk of input) {
      while (datas.length) {
        yield datas.shift();
      }
      await new Promise((resolve, reject) => {
        gz.write(chunk, err => {
          if (err) {
            reject(err);
            return;
          }
          resolve();
        });
      });
      while (datas.length) {
        yield datas.shift();
      }
    }
    while (datas.length) {
      yield datas.shift();
    }
    await new Promise((resolve, reject) => {
      gz.once('end', resolve);
      gz.once('error', reject);
      gz.end();
    });
    while (datas.length) {
      yield datas.shift();
    }
  }
}
exports.ArchiveTarGz = ArchiveTarGz;
//# sourceMappingURL=gz.js.map